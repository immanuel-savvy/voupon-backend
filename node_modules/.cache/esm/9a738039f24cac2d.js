let ADMINSTRATORS,ADMIN_HASH,GLOBALS,VENDORS,GLOBAL_pending_vendors;_f24‍.x([["admin_login",()=>admin_login],["create_admin",()=>create_admin],["get_admins",()=>get_admins],["client_domain",()=>client_domain],["stats",()=>stats],["domain_name",()=>domain_name],["paystack_secret_key",()=>paystack_secret_key]]);_f24‍.w("../ds/conn",[["ADMINSTRATORS",["ADMINSTRATORS"],function(v){ADMINSTRATORS=v}],["ADMIN_HASH",["ADMIN_HASH"],function(v){ADMIN_HASH=v}],["GLOBALS",["GLOBALS"],function(v){GLOBALS=v}],["VENDORS",["VENDORS"],function(v){VENDORS=v}]]);_f24‍.w("./starter",[["GLOBAL_pending_vendors",["GLOBAL_pending_vendors"],function(v){GLOBAL_pending_vendors=v}]]);


const domain_name = "https://dev.voucherafrica.com:2555";

const client_domain = "http://voucherafrica.com";

const paystack_secret_key = "sk_test_8f53d8f0d9303a18a856d4aeba97603d0795fdcb";

const admin_login = (req, res) => {
  let { email, password } = req.body;

  let admin = ADMINSTRATORS.readone({ email });
  if (admin) {
    let hash = ADMIN_HASH.readone({ admin: admin._id });

    res.json(
      hash.key === password
        ? { ok: true, message: "admin logged-in", data: { admin } }
        : { ok: false, data: { message: "incorrect password" } }
    );
  } else res.json({ ok: false, data: { message: "admin not found" } });
};

const get_admins = (req, res) => {
  let admins = ADMINSTRATORS.read();
  res.json({ ok: true, message: "adminstrators fetched", data: admins });
};

const create_admin = (req, res) => {
  let { email, password, firstname, lastname } = req.body;

  let admin = { email, firstname, lastname };

  let result = ADMINSTRATORS.write(admin);
  admin._id = result._id;
  admin.created = result.created;

  ADMIN_HASH.write({ admin: admin._id, key: password });

  res.json({ ok: true, message: "admin created", data: admin });
};

const stats = (req, res) => {
  let stats_ = new Array();

  let pending_vendors = GLOBALS.readone({ global: GLOBAL_pending_vendors });
  stats_.push({ title: "total_vendors", value: VENDORS.config.total_entries });
  stats_.push({
    title: "pending_vendors",
    value: pending_vendors.vendors.length,
  });

  res.json({ ok: true, message: "stats", data: stats_ });
};










